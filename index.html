<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>å¥åº·èŠ‚å¥ RUN â€” RPG é‡Œç¨‹ç‰ˆï¼ˆé¢„è§ˆï¼‰</title>
  <style>
    :root{--bg:#f3faf6;--card:#ffffff;--accent:#2fb86a;--muted:#6b7a72}
    html,body{height:100%;margin:0;font-family:PingFang SC,Helvetica,Arial;background:linear-gradient(180deg,#eaf6f1,#dff0e8)}
    .wrap{display:flex;flex-direction:column;align-items:center;padding:12px}
    .stage{width:360px;max-width:94vw;background:var(--card);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.12);overflow:hidden}
    .header{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid #eef6ef}
    .logo{font-weight:800;color:var(--accent)}
    .meta{font-size:13px;color:var(--muted)}
    .hero{height:220px;background:linear-gradient(180deg,#d7f6e2,#bfeeda);position:relative}
    .parallax{position:absolute;left:0;right:0;top:0;bottom:0;overflow:hidden}
    .runner{position:absolute;left:150px;top:140px;width:64px;height:64px;border-radius:10px;background:#fff;display:flex;align-items:center;justify-content:center;font-size:32px;box-shadow:0 8px 20px rgba(0,0,0,.12)}
    .stats{display:flex;justify-content:space-around;padding:10px 8px;background:#fff;border-top:1px solid #eef6ef}
    .stat{display:flex;flex-direction:column;align-items:center}
    .stat .num{font-weight:700;color:#333}
    .controls{padding:12px;background:#fff}
    .panel{background:#fff;padding:12px;border-top:1px solid #eef6ef}
    .progress{height:10px;background:#f0fbf2;border-radius:6px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,var(--accent),#4bd07d);width:0%}
    .btn{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:none;font-weight:700}
    .small{font-size:12px;color:var(--muted)}
    .map{padding:10px;display:flex;gap:8px;flex-wrap:wrap}
    .item{background:#f7fffa;padding:8px;border-radius:8px;border:1px solid #e6f6ea}
    footer{padding:8px;text-align:center;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="stage" id="stage">
      <div class="header">
        <div class="logo">å¥åº·èŠ‚å¥ RUN</div>
        <div class="meta">Lv <span id="level">1</span> Â· æ€»é‡Œç¨‹ <span id="totalKm">0</span> km</div>
      </div>

      <div class="hero">
        <div class="parallax" id="parallax">
          <div class="runner" id="runner">ğŸƒ</div>
        </div>
      </div>

      <div class="stats">
        <div class="stat"><div class="small">ä»Šæ—¥é‡Œç¨‹</div><div class="num" id="today">0 m</div></div>
        <div class="stat"><div class="small">EXP</div><div class="num" id="exp">0 / 100</div></div>
        <div class="stat"><div class="small">èƒ½é‡</div><div class="num" id="energy">0</div></div>
      </div>

      <div class="controls">
        <div style="display:flex;gap:8px;justify-content:space-between;align-items:center;margin-bottom:8px">
          <button class="btn" id="startBtn">å¼€å§‹è·‘æ­¥</button>
          <button class="btn" id="syncBtn" style="background:#5b8aee">è®¡æ­¥åŒæ­¥</button>
        </div>
        <div class="small">ç©æ³•ï¼šç‚¹å‡»â€œå¼€å§‹è·‘æ­¥â€åï¼Œæ¨¡æ‹Ÿè·‘æ­¥ä¼šå¼€å§‹ç´¯ç§¯é‡Œç¨‹ã€‚é‡Œç¨‹ä¼šå…‘æ¢ EXPã€æå‡ç­‰çº§å¹¶è·å¾—èƒ½é‡ã€‚ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨â€œåˆæˆè£…å¤‡â€æå‡æ¯æ¬¡è·‘æ­¥çš„æ•ˆç‡ã€‚</div>
      </div>

      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div class="small">é‡Œç¨‹è¿›åº¦ï¼ˆè§£é”åœ°å›¾ï¼‰</div>
          <div class="small">ç›®æ ‡ï¼š1000 m è§£é”æ–°åŒºåŸŸ</div>
        </div>
        <div class="progress" style="margin-bottom:8px"><div class="bar" id="bar"></div></div>
        <div class="map" id="map"></div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" id="shopBtn" style="flex:1;background:#f39c12">è£…å¤‡å•†åº—</button>
          <button class="btn" id="claimBtn" style="flex:1;background:#27ae60">å…‘æ¢èƒ½é‡</button>
        </div>
      </div>

      <footer>ï¼ˆæ¼”ç¤ºç‰ˆï¼‰é‡Œç¨‹ã€ç­‰çº§ã€è£…å¤‡æ•°æ®ä¼šä¿å­˜åœ¨æœ¬åœ°ã€‚å¯ç”¨äºæ´»åŠ¨è½¬æ¢ä¸å“ç‰ŒåŒ–å»¶å±•ã€‚</footer>
    </div>
  </div>

  <script>
  // RPG è·‘æ­¥æ ¸å¿ƒé€»è¾‘ï¼ˆå•æ–‡ä»¶å¯ç©ç‰ˆï¼‰
  (function(){
    // persistent storage keys
    const STORE_PREFIX = 'hrun_v1_';
    const $ = id=>document.getElementById(id);
    // player state
    let state = {
      totalMeters: Number(localStorage.getItem(STORE_PREFIX+'totalMeters')||0),
      level: Number(localStorage.getItem(STORE_PREFIX+'level')||1),
      exp: Number(localStorage.getItem(STORE_PREFIX+'exp')||0),
      energy: Number(localStorage.getItem(STORE_PREFIX+'energy')||0),
      items: JSON.parse(localStorage.getItem(STORE_PREFIX+'items')||'[]')
    };

    // UI refs
    const runner = $('runner');
    const levelEl = $('level');
    const totalKmEl = $('totalKm');
    const todayEl = $('today');
    const expEl = $('exp');
    const energyEl = $('energy');
    const bar = $('bar');
    const mapEl = $('map');

    // runtime
    let running = false;
    let sessionMeters = 0;
    let tickId = null;

    function saveState(){
      localStorage.setItem(STORE_PREFIX+'totalMeters', state.totalMeters);
      localStorage.setItem(STORE_PREFIX+'level', state.level);
      localStorage.setItem(STORE_PREFIX+'exp', state.exp);
      localStorage.setItem(STORE_PREFIX+'energy', state.energy);
      localStorage.setItem(STORE_PREFIX+'items', JSON.stringify(state.items));
    }

    function ui(){
      levelEl.textContent = state.level;
      totalKmEl.textContent = Math.floor(state.totalMeters/1000);
      todayEl.textContent = sessionMeters + ' m';
      expEl.textContent = state.exp + ' / ' + (100 + (state.level-1)*30);
      energyEl.textContent = state.energy;
      // progress to next map (use 1000m per map)
      const pct = Math.min(1, (sessionMeters % 1000)/1000);
      bar.style.width = (pct*100)+'%';
      // map boxes
      mapEl.innerHTML = '';
      const unlocked = Math.floor(state.totalMeters/1000) + (sessionMeters>=1000?1:0);
      for(let i=0;i<4;i++){
        const div = document.createElement('div'); div.className='item';
        div.textContent = (i<=unlocked? 'ğŸ”“':'ğŸ”’') + ' åŒºåŸŸ ' + (i+1);
        mapEl.appendChild(div);
      }
    }

    function addMeters(m){
      sessionMeters += m;
      state.totalMeters += m;
      // convert meters to EXP: 100m -> 1 exp
      const gainedExp = Math.floor(m/100);
      state.exp += gainedExp;
      // energy gain: 50m -> 1 energy
      state.energy += Math.floor(m/50);
      // level up
      const need = 100 + (state.level-1)*30;
      while(state.exp >= need){ state.exp -= need; state.level += 1; }
      saveState(); ui();
    }

    // simulate running: each tick adds meters. tick every 600ms
    function startRun(){ if(running) return; running=true; sessionMeters=0; tickId = setInterval(()=>{ addMeters(60); runner.style.transform = 'translateY(-6px)'; setTimeout(()=>runner.style.transform='translateY(0)',200); }, 600); }
    function stopRun(){ if(!running) return; running=false; clearInterval(tickId); tickId=null; alert('æœ¬æ¬¡è·‘æ­¥ç»“æŸï¼š+'+sessionMeters+' mï¼Œå·²è·å¾— EXP ä¸èƒ½é‡ã€‚'); saveState(); ui(); }

    // shop: simple equipment that increases meters per tick
    const shop = [ {id:'shoes1',name:'å…¥é—¨è·‘é‹',cost:50,bonus:10}, {id:'shoes2',name:'è¿›é˜¶è·‘é‹',cost:150,bonus:20} ];
    function openShop(){
      let html = shop.map(s=>`ã€${s.name}ã€‘èŠ±è´¹ ${s.cost} èƒ½é‡ï¼Œæ•ˆæœ +${s.bonus}m/æ¬¡ <button data-id="${s.id}">è´­ä¹°</button>`).join('
');
      const wrapper = document.createElement('div'); wrapper.style.padding='12px'; wrapper.style.background='#fff'; wrapper.style.borderRadius='10px'; wrapper.style.boxShadow='0 8px 24px rgba(0,0,0,.12)';
      wrapper.innerHTML = html;
      document.body.appendChild(wrapper);
      wrapper.addEventListener('click', e=>{
        if(e.target.tagName==='BUTTON'){
          const id = e.target.dataset.id; const s = shop.find(x=>x.id===id);
          if(state.energy >= s.cost){ state.energy -= s.cost; state.items.push(s); alert('è´­ä¹°æˆåŠŸï¼š'+s.name); saveState(); ui(); } else alert('èƒ½é‡ä¸è¶³');
        }
      });
      setTimeout(()=>document.body.removeChild(wrapper),8000);
    }

    // sync steps (mock) â€” user can input steps to convert
    function syncSteps(){
      const v = prompt('è¾“å…¥è¦åŒæ­¥çš„æ­¥æ•°ï¼ˆç¤ºä¾‹ï¼š1000 æ­¥ â‰ˆ 800 ç±³ï¼‰','1000');
      const steps = Number(v)||0; const meters = Math.round(steps*0.8);
      addMeters(meters);
      alert('åŒæ­¥æˆåŠŸï¼š' + meters + ' m å·²åŠ å…¥é‡Œç¨‹');
    }

    // claim convert energy -> coupon (demo)
    function claim(){ if(state.energy >= 100){ state.energy -= 100; alert('å…‘æ¢æˆåŠŸï¼šè·å¾— 1 å¼ æŠ˜æ‰£åˆ¸ï¼ˆç¤ºä¾‹ï¼‰'); saveState(); ui(); } else alert('èƒ½é‡ä¸è¶³ 100'); }

    // attach events
    $('startBtn').addEventListener('click', ()=>{ if(!running) startRun(); else stopRun(); });
    $('shopBtn').addEventListener('click', openShop);
    $('syncBtn').addEventListener('click', syncSteps);
    $('claimBtn').addEventListener('click', claim);

    // init
    ui();
  })();
  </script>
</body>
</html>
